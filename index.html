<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù…Ø¹Ø±Ø¶ ÙˆØ³Ø§Ø¦Ø· Ù…Ø³ØªØ¬ÙŠØ¨ Ù„Ù„ØºØ§ÙŠØ©</title>
  <style>
    /* Reset + base */
    *, *::before, *::after { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: #0d0f12;
      color: #f6f7f9;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Naskh Arabic UI", "Noto Sans Arabic", Arial, sans-serif;
      overflow: hidden; /* true fullscreen experience */
    }

    /* Layout */
    .app {
      position: fixed;
      inset: 0;
      display: grid;
      grid-template-rows: 1fr auto;
    }

    .stage {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      background: #0a0c0f;
      user-select: none;
      -webkit-user-select: none;
      touch-action: manipulation;
    }

    /* The media element fills the screen. We'll switch between <img> and <video>. */
    .media {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover; /* default fill mode (no Ø£Ø´Ø±Ø·Ø© Ø³ÙˆØ¯Ø§Ø¡) */
      object-position: center center;
      background: #0a0c0f;
    }

    .hidden { display: none !important; }

    /* Top info bar */
    .topbar {
      position: absolute;
      top: 0; left: 0; right: 0;
      display: flex;
      align-items: center;
      gap: .75rem;
      padding: .6rem .9rem;
      background: linear-gradient(to bottom, rgba(0,0,0,.55), rgba(0,0,0,0));
      pointer-events: none; /* clicks pass through */
      z-index: 3;
    }
    .badge {
      pointer-events: auto;
      font-size: .85rem;
      padding: .2rem .5rem;
      border-radius: 999px;
      background: rgba(255,255,255,.12);
      border: 1px solid rgba(255,255,255,.18);
    }

    /* Controls */
    .controls {
      position: absolute;
      left: 0; right: 0; bottom: 0;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: .5rem;
      padding: .75rem .9rem;
      background: linear-gradient(to top, rgba(0,0,0,.55), rgba(0,0,0,0));
      z-index: 3;
    }

    .spacer { flex: 1; }

    button, .btn {
      appearance: none;
      border: 1px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.08);
      color: #fff;
      padding: .55rem .75rem;
      border-radius: .7rem;
      font-size: .95rem;
      cursor: pointer;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
    }
    button:hover { background: rgba(255,255,255,.14); border-color: rgba(255,255,255,.35); }
    button:active { transform: scale(.98); }

    .progress {
      position: relative;
      height: 6px;
      flex: 1 1 260px;
      background: rgba(255,255,255,.12);
      border-radius: 999px;
      overflow: hidden;
      cursor: pointer;
    }
    .progress > .bar {
      position: absolute; left: 0; top: 0; bottom: 0;
      width: 0%;
      background: linear-gradient(90deg, #4ade80, #22d3ee);
    }

    .caption {
      max-width: min(70ch, 85vw);
      font-size: .95rem;
      opacity: .9;
      text-shadow: 0 1px 2px rgba(0,0,0,.65);
      pointer-events: auto;
    }

    /* Help toast */
    .hint {
      position: absolute;
      right: .8rem; top: .8rem;
      z-index: 4;
      background: rgba(0,0,0,.6);
      border: 1px solid rgba(255,255,255,.2);
      padding: .45rem .6rem;
      border-radius: .6rem;
      font-size: .9rem;
      opacity: .85;
    }

    /* Compact on very small screens */
    @media (max-width: 480px) {
      .controls { gap: .4rem; padding: .55rem .6rem; }
      button { padding: .45rem .55rem; font-size: .9rem; }
      .caption { font-size: .9rem; }
    }
  </style>
</head>
<body>
  <div class="app" id="app">
    <div class="stage" id="stage" aria-live="polite" aria-label="Ø¹Ø§Ø±Ø¶ Ø§Ù„ÙˆØ³Ø§Ø¦Ø·">
      <img id="img" class="media" alt="" />
      <video id="vid" class="media hidden" playsinline preload="metadata"></video>

      <div class="topbar" id="topbar">
        <span class="badge" id="counter">0 / 0</span>
        <span class="badge" id="modeBadge">Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©: ØªØ¹Ø¨Ø¦Ø©</span>
        <span class="badge" id="typeBadge">ØµÙˆØ±Ø©</span>
        <div class="caption" id="caption"></div>
      </div>

      <div class="hint" id="hint">Ø§Ù„Ù…ÙØ§ØªÙŠØ­: â—€ï¸ â–¶ï¸ / Ù…Ø³Ø§ÙØ© ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù / F Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø© / M ÙƒØªÙ…</div>

      <div class="controls" id="controls">
        <button id="prevBtn" title="Ø§Ù„Ø³Ø§Ø¨Ù‚">â—€ï¸</button>
        <button id="playBtn" title="ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù">â–¶ï¸ ØªØ´ØºÙŠÙ„</button>
        <button id="nextBtn" title="Ø§Ù„ØªØ§Ù„ÙŠ">â–¶ï¸</button>
        <div class="progress" id="progress" title="Ø§Ù„Ù‚ÙØ² Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¹Ù†ØµØ±">
          <div class="bar" id="bar"></div>
        </div>
        <div class="spacer"></div>
        <button id="fitBtn" title="Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† ØªØ¹Ø¨Ø¦Ø©/Ù…Ù„Ø§Ø¡Ù…Ø©">ØªØ¹Ø¨Ø¦Ø©</button>
        <button id="muteBtn" title="ÙƒØªÙ…/Ø¥Ù„ØºØ§Ø¡ ÙƒØªÙ… Ù„Ù„ÙÙŠØ¯ÙŠÙˆ">ğŸ”‡</button>
        <button id="fsBtn" title="Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©">â¤¢</button>
      </div>
    </div>
  </div>

  <script>
    // ===== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ =====
    // Ø³Ø±Ø¹Ø© Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± (Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ). Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙŠØªØ¬Ø§Ù‡Ù„ Ù‡Ø°Ø§ ÙˆÙŠÙˆÙ‚Ù Ø§Ù„ØªÙ‚Ø¯Ù… Ø­ØªÙ‰ ÙŠÙ†ØªÙ‡ÙŠ.
    const IMAGE_DURATION = 4.0;

    // Ù…Ø³Ø§Ø± Ù…Ù„Ù JSON Ø§Ø®ØªÙŠØ§Ø±ÙŠ: Ø¥Ø°Ø§ ÙˆÙØ¬Ø¯ /images.json Ù†Ø­Ù…Ù„Ù‡ØŒ ÙˆØ¥Ù„Ø§ Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¶Ù…Ù‘Ù†Ø©.
    // ÙŠØ¯Ø¹Ù… Ø§Ù„Ø´ÙƒÙ„ÙŠÙ†: {"media":[...]} Ø£Ùˆ {"images":[...]} ÙƒÙ…Ø§ Ø·Ù„Ø¨Øª Ø³Ø§Ø¨Ù‚Ù‹Ø§.
    const JSON_CANDIDATES = ["./images.json", "./media.json"]; // ØºÙŠÙ‘Ø± ÙƒÙ…Ø§ ØªØ´Ø§Ø¡

    // Ù‚Ø§Ø¦Ù…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (fallback) â€” Ø¹Ø¯Ù‘Ù„Ù‡Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø£Ùˆ Ø§Ø¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ images.json
    const FALLBACK_MEDIA = [
      // Ø£Ù…Ø«Ù„Ø© â€” Ø§Ø³ØªØ¨Ø¯Ù„Ù‡Ø§ Ø¨Ù…Ù„ÙØ§ØªÙƒ Ø¨Ø¹Ø¯ Ø§Ù„Ø±ÙØ¹ Ø¹Ù„Ù‰ GitHub Pages
      // ØµÙˆØ±
      "demo/photo1.jpg",
      "demo/photo2-portrait.jpg",
      // ÙÙŠØ¯ÙŠÙˆ (Ø³ÙŠÙˆÙ‚Ù Ø§Ù„Ø³Ù„Ø§ÙŠØ¯ Ø­ØªÙ‰ ÙŠÙ†ØªÙ‡ÙŠ)
      "demo/sample.mp4",
      "demo/photo3.jpg"
    ];

    // ===== Ù…Ù† Ù‡Ù†Ø§ ÙŠØ¨Ø¯Ø£ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ =====
    const app = {
      list: [],
      i: 0,
      timer: null,
      playing: true,
      fillMode: 'cover', // Ø£Ùˆ 'contain'
      muted: true,
      // DOM
      img: document.getElementById('img'),
      vid: document.getElementById('vid'),
      bar: document.getElementById('bar'),
      progress: document.getElementById('progress'),
      counter: document.getElementById('counter'),
      typeBadge: document.getElementById('typeBadge'),
      modeBadge: document.getElementById('modeBadge'),
      caption: document.getElementById('caption'),
      playBtn: document.getElementById('playBtn'),
      prevBtn: document.getElementById('prevBtn'),
      nextBtn: document.getElementById('nextBtn'),
      fitBtn: document.getElementById('fitBtn'),
      muteBtn: document.getElementById('muteBtn'),
      fsBtn: document.getElementById('fsBtn'),
      stage: document.getElementById('stage'),
    };

    // helpers
    function isVideo(path) {
      return /\.(mp4|webm|ogg)$/i.test(path);
    }
    function baseName(path){
      try { return decodeURIComponent(path.split('/').pop()); } catch { return path; }
    }

    async function loadJsonList() {
      for (const url of JSON_CANDIDATES) {
        try {
          const res = await fetch(url, { cache: 'no-store' });
          if (!res.ok) continue;
          const data = await res.json();
          const arr = Array.isArray(data.media) ? data.media : Array.isArray(data.images) ? data.images : null;
          if (arr && arr.length) return arr;
        } catch (_) { /* ignore */ }
      }
      return null;
    }

    function preloadNext(idx) {
      const next = app.list[(idx + 1) % app.list.length];
      if (!next) return;
      if (isVideo(next)) return; // Ù„Ø§ Ù†ÙØ­Ù…Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù…Ø³Ø¨Ù‚Ù‹Ø§ Ù‡Ù†Ø§
      const img = new Image();
      img.src = next;
    }

    function updateBadges(type, src){
      app.counter.textContent = `${app.i + 1} / ${app.list.length}`;
      app.typeBadge.textContent = type === 'video' ? 'ÙÙŠØ¯ÙŠÙˆ' : 'ØµÙˆØ±Ø©';
      app.modeBadge.textContent = `Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©: ${app.fillMode === 'cover' ? 'ØªØ¹Ø¨Ø¦Ø©' : 'Ù…Ù„Ø§Ø¡Ù…Ø©'}`;
      app.caption.textContent = baseName(src);
    }

    function setFillMode(mode){
      app.fillMode = mode;
      app.img.style.objectFit = mode;
      app.vid.style.objectFit = mode;
      app.modeBadge.textContent = `Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©: ${mode === 'cover' ? 'ØªØ¹Ø¨Ø¦Ø©' : 'Ù…Ù„Ø§Ø¡Ù…Ø©'}`;
      app.fitBtn.textContent = mode === 'cover' ? 'ØªØ¹Ø¨Ø¦Ø©' : 'Ù…Ù„Ø§Ø¡Ù…Ø©';
    }

    function setPlayUI(){
      app.playBtn.textContent = app.playing ? 'â¸ï¸ Ø¥ÙŠÙ‚Ø§Ù' : 'â–¶ï¸ ØªØ´ØºÙŠÙ„';
    }

    function showImage(src){
      clearTimer();
      app.vid.classList.add('hidden');
      app.vid.pause();
      app.img.classList.remove('hidden');
      app.img.src = src;
      updateBadges('image', src);
      startProgress(IMAGE_DURATION);
      if (app.playing) {
        app.timer = setTimeout(next, IMAGE_DURATION * 1000);
      }
      preloadNext(app.i);
    }

    function showVideo(src){
      clearTimer();
      app.img.classList.add('hidden');
      app.vid.classList.remove('hidden');
      app.vid.src = src;
      app.vid.muted = app.muted; // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ
      updateBadges('video', src);

      // Ø³Ù†Ø­Ø§ÙˆÙ„ Ø§Ù„ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ (ØºØ§Ù„Ø¨Ù‹Ø§ ÙŠØªØ·Ù„Ø¨ ÙƒØªÙ… Ø§Ù„ØµÙˆØª Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§)
      const tryPlay = app.vid.play();
      if (tryPlay && typeof tryPlay.then === 'function') {
        tryPlay.then(() => {
          watchVideoProgress();
        }).catch(() => {
          // Ø§Ù„Ù…ØªØµÙØ­ Ù…Ù†Ø¹ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ â€” Ù†Ø¹Ø±Ø¶ Ø²Ø± ØªØ´ØºÙŠÙ„ Ø¹Ø¨Ø± ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£ØµÙ„ÙŠØ©
          app.playing = false;
          setPlayUI();
          watchVideoProgress(); // Ø³Ù†Ø­Ø¯Ù‘Ø« Ø§Ù„Ø´Ø±ÙŠØ· Ø¹Ù†Ø¯ Ø§Ù„ØªÙ‚Ø¯Ù… Ø¨Ø¹Ø¯ Ø§Ù„Ø¶ØºØ·
        });
      } else {
        watchVideoProgress();
      }

      // Ø¹Ù†Ø¯ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù†Ù†ØªÙ‚Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
      app.vid.onended = () => {
        if (app.playing) next();
      }
    }

    function watchVideoProgress(){
      clearTimer();
      // Ù†Ø³ØªØ®Ø¯Ù… requestAnimationFrame Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø±ÙŠØ· Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
      function step(){
        if (!app.vid.classList.contains('hidden') && !isNaN(app.vid.duration) && app.vid.duration > 0){
          const p = (app.vid.currentTime / app.vid.duration) * 100;
          app.bar.style.width = p + '%';
        }
        app.timer = requestAnimationFrame(step);
      }
      app.timer = requestAnimationFrame(step);
    }

    function startProgress(seconds){
      const start = performance.now();
      function tick(now){
        const t = (now - start) / 1000;
        const p = Math.min(100, (t / seconds) * 100);
        app.bar.style.width = p + '%';
        if (t < seconds && app.playing) {
          app.timer = requestAnimationFrame(tick);
        }
      }
      app.timer = requestAnimationFrame(tick);
    }

    function clearTimer(){
      if (app.timer) {
        cancelAnimationFrame(app.timer);
        clearTimeout(app.timer);
        app.timer = null;
      }
      app.bar.style.width = '0%';
    }

    function showCurrent(){
      const src = app.list[app.i];
      if (!src) return;
      if (isVideo(src)) showVideo(src); else showImage(src);
    }

    function prev(){
      app.i = (app.i - 1 + app.list.length) % app.list.length;
      showCurrent();
    }
    function next(){
      app.i = (app.i + 1) % app.list.length;
      showCurrent();
    }

    function togglePlay(){
      app.playing = !app.playing;
      setPlayUI();
      if (app.vid.classList.contains('hidden')){
        if (app.playing) { startProgress(IMAGE_DURATION); app.timer = setTimeout(next, IMAGE_DURATION * 1000); }
        else { clearTimer(); }
      } else {
        if (app.playing) {
          app.vid.play().catch(()=>{});
        } else {
          app.vid.pause();
        }
      }
    }

    function toggleFill(){
      setFillMode(app.fillMode === 'cover' ? 'contain' : 'cover');
    }

    function toggleMute(){
      app.muted = !app.muted;
      app.vid.muted = app.muted;
      app.muteBtn.textContent = app.muted ? 'ğŸ”‡' : 'ğŸ”Š';
    }

    function seekByPercent(percent){
      if (!app.list.length) return;
      const src = app.list[app.i];
      if (isVideo(src) && !isNaN(app.vid.duration) && app.vid.duration > 0){
        app.vid.currentTime = percent * app.vid.duration;
      } else {
        // Ù„Ù„ØµÙˆØ±Ø©: Ù†Ù‚ÙØ² Ø¥Ù„Ù‰ Ø¹Ù†ØµØ± Ø¢Ø®Ø± ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        const targetIndex = Math.floor(percent * app.list.length);
        app.i = Math.min(app.list.length - 1, Math.max(0, targetIndex));
        showCurrent();
      }
    }

    // UI events
    app.prevBtn.addEventListener('click', prev);
    app.nextBtn.addEventListener('click', next);
    app.playBtn.addEventListener('click', togglePlay);
    app.fitBtn.addEventListener('click', toggleFill);
    app.muteBtn.addEventListener('click', toggleMute);

    app.fsBtn.addEventListener('click', () => {
      const el = document.documentElement;
      if (!document.fullscreenElement) el.requestFullscreen?.(); else document.exitFullscreen?.();
    });

    // Progress click
    app.progress.addEventListener('click', (e) => {
      const rect = app.progress.getBoundingClientRect();
      const p = (e.clientX - rect.left) / rect.width;
      seekByPercent(Math.min(1, Math.max(0, p)));
    });

    // Keyboard shortcuts
    window.addEventListener('keydown', (e) => {
      if (['ArrowRight','ArrowLeft',' ','Spacebar','f','F','m','M'].includes(e.key)) e.preventDefault();
      if (e.key === 'ArrowRight') next();
      if (e.key === 'ArrowLeft') prev();
      if (e.key === ' ' || e.key === 'Spacebar') togglePlay();
      if (e.key === 'f' || e.key === 'F') app.fsBtn.click();
      if (e.key === 'm' || e.key === 'M') toggleMute();
    });

    // Tap stage to toggle controls visibility (helpful Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„)
    let controlsVisible = true;
    app.stage.addEventListener('click', (e) => {
      // Ù„Ø§ ØªÙØ®ÙÙŠ Ø¥Ù† ÙƒØ§Ù† Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø±
      if (e.target.closest('button') || e.target.closest('.progress')) return;
      controlsVisible = !controlsVisible;
      document.getElementById('controls').style.display = controlsVisible ? '' : 'none';
      document.getElementById('topbar').style.display = controlsVisible ? '' : 'none';
      document.getElementById('hint').style.display = controlsVisible ? '' : 'none';
    });

    // Boot
    (async function init(){
      const loaded = await loadJsonList();
      app.list = Array.isArray(loaded) && loaded.length ? loaded : FALLBACK_MEDIA;
      // Ù…Ø¹ GitHub Pages Ù‚Ø¯ ØªÙØ­ÙØ¸ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¯Ø§Ø®Ù„ Ù…Ø¬Ù„Ø¯ØŒ Ø§Ø­Ø±Øµ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©
      if (!app.list.length) {
        app.list = FALLBACK_MEDIA;
      }
      setFillMode('cover');
      setPlayUI();
      toggleMute(); // ÙŠØ¨Ø¯Ø£ Ù…ÙƒØªÙˆÙ…Ù‹Ø§ Ù„Ø§Ø­ØªØ±Ø§Ù… Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
      toggleMute(); // Ø«Ù… Ù†Ø¹ÙŠØ¯ Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰ Ù…ÙƒØªÙˆÙ…=true Ø¨Ø´ÙƒÙ„ ØµØ±ÙŠØ­ ÙÙŠ UI
      app.muted = true; app.vid.muted = true; app.muteBtn.textContent = 'ğŸ”‡';
      app.playing = true; setPlayUI();
      app.i = 0;
      showCurrent();
    })();
  </script>
</body>
</html>
