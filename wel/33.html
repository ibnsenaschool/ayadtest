<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø§Ù„ØªÙ‚ÙˆÙŠÙ… (Ø¥ØµØ¯Ø§Ø± Ù…ÙØ¹Ø§Ø¯ Ø§Ù„Ø¨Ù†Ø§Ø¡)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap');
    body{font-family:'Tajawal',sans-serif;}
    .calendar-shell{background:linear-gradient(to bottom right,#eff6ff,#f3e8ff,#fce7f3);min-height:100vh;padding:16px;}
    .week-header{background:linear-gradient(135deg,#2563eb 0%,#1d4ed8 100%);color:#fff;padding:18px;text-align:center;font-weight:900;font-size:18px;}
    .calendar-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:0;border-top:1px solid #e5e7eb;}
    .day-cell{position:relative;background:#fff;border:1px solid #e5e7eb;min-height:180px;transition:transform .15s, background .15s;cursor:pointer;}
    .day-cell:hover{background:#eff6ff;transform:translateY(-2px);z-index:2;}
    .day-number{position:absolute;top:10px;right:12px;font-weight:900;font-size:20px;color:#111827;}
    .today{background:linear-gradient(135deg,#d1fae5 0%,#a7f3d0 100%)!important;border:3px solid #10b981!important;box-shadow:0 6px 25px rgba(16,185,129,.35)!important;}
    .today .day-number{color:#065f46!important;font-size:22px;}
    .selected{background:linear-gradient(135deg,#dbeafe 0%,#bfdbfe 100%)!important;border:3px solid #3b82f6!important;}
    .events{position:absolute;left:8px;right:8px;top:44px;bottom:8px;overflow:auto;}
    .events::-webkit-scrollbar{width:6px}
    .events::-webkit-scrollbar-thumb{background:#94a3b8;border-radius:4px}
    .event{background:linear-gradient(135deg,#e0e7ff 0%,#c7d2fe 100%);color:#3730a3;padding:6px 10px;border-radius:8px;margin-bottom:6px;font-weight:800;display:flex;align-items:center;justify-content:space-between;box-shadow:0 2px 4px rgba(0,0,0,.08);}
    .event .del{opacity:0;transition:opacity .15s;color:#dc2626;background:#fff;padding:0 6px;border-radius:4px;font-weight:900;margin-right:6px;}
    .event:hover .del{opacity:1}
    .fab{position:fixed;left:16px;bottom:16px;z-index:50}
  </style>
</head>
<body class="calendar-shell">
  <div class="max-w-[1600px] mx-auto space-y-4">

    <!-- Header -->
    <div class="bg-white rounded-3xl shadow-xl p-6">
      <div class="flex items-center justify-center">
        <h1 id="title" class="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600"></h1>
      </div>
    </div>

    <!-- Nav + datetime -->
    <div class="bg-white rounded-3xl shadow-2xl">
      <div class="grid grid-cols-5 gap-2 p-2 bg-slate-50">
        <button id="prev" class="rounded-xl text-white font-black text-lg h-24 shadow-lg bg-gradient-to-br from-amber-500 to-orange-600 hover:scale-[1.02] transition">â† Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
        <div class="col-span-3 rounded-xl h-24 flex items-center justify-between px-8 text-white font-black shadow-lg bg-gradient-to-r from-emerald-500 to-emerald-700">
          <div id="now-date" class="text-4xl"></div>
          <div id="now-day" class="text-4xl"></div>
          <div id="now-time" class="text-4xl"></div>
        </div>
        <button id="next" class="rounded-xl text-white font-black text-lg h-24 shadow-lg bg-gradient-to-br from-violet-500 to-violet-700 hover:scale-[1.02] transition">Ø§Ù„ØªØ§Ù„ÙŠ â†’</button>
      </div>

      <!-- Week headers -->
      <div class="calendar-grid rounded-b-3xl overflow-hidden">
        <div class="week-header">Ø§Ù„Ø£Ø­Ø¯</div>
        <div class="week-header">Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</div>
        <div class="week-header">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</div>
        <div class="week-header">Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</div>
        <div class="week-header">Ø§Ù„Ø®Ù…ÙŠØ³</div>
      </div>

      <!-- Days grid -->
      <div id="grid" class="calendar-grid rounded-b-3xl overflow-visible"></div>
    </div>

    <!-- Legend + Link -->
    <div class="bg-white rounded-3xl shadow-xl p-4">
      <div class="flex flex-wrap items-center justify-center gap-6 text-sm mb-4">
        <div class="flex items-center gap-2"><div class="w-4 h-4 rounded bg-green-400 border-2 border-green-600 shadow"></div><span class="font-bold text-gray-800">Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ</span></div>
        <div class="flex items-center gap-2"><div class="w-4 h-4 rounded bg-indigo-300 shadow"></div><span class="font-bold text-gray-800">ÙØ¹Ø§Ù„ÙŠØ©</span></div>
        <div class="flex items-center gap-2"><span class="text-xl">ğŸ’¡</span><span class="font-bold text-gray-800">Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙˆÙ… Ù„Ø¥Ø¶Ø§ÙØ© ÙØ¹Ø§Ù„ÙŠØ§Øª</span></div>
        <div class="flex items-center gap-2"><span class="text-xl">ğŸ—‘ï¸</span><span class="font-bold text-gray-800">Ù…Ø±Ø± Ø¹Ù„Ù‰ Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ© Ù„Ù„Ø­Ø°Ù</span></div>
      </div>
      <div class="flex justify-center">
        <button id="saveNow" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-black shadow-lg flex items-center gap-2">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª</button>
        <button id="openSettings" class="px-4 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-xl font-black shadow-lg flex items-center gap-2">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
      </div>
    </div>
  </div>

  <!-- Add Event Panel -->
  <div id="panel" class="fixed left-0 right-0 bottom-0 z-40 hidden">
    <div class="bg-white shadow-2xl border-t-4 border-blue-600 max-w-[1600px] mx-auto p-6 rounded-t-3xl">
      <h2 id="panelTitle" class="text-2xl font-black mb-3 text-gray-800"></h2>
      <div class="flex gap-2 mb-3">
        <input id="input" type="text" placeholder="âœï¸ Ø§ÙƒØªØ¨ Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ© Ø«Ù… Enter Ø£Ùˆ Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ©" class="flex-1 px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-100 text-lg font-bold">
        <button id="addBtn" class="px-6 py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl font-black shadow">âœ“ Ø¥Ø¶Ø§ÙØ©</button>
      </div>
      <button id="done" class="w-full px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white rounded-xl font-black shadow">âœ“ ØªÙ…</button>
    </div>
  </div>

  <!-- FAB -->
  <button id="fab" class="fab px-5 py-3 rounded-2xl shadow-2xl bg-gradient-to-r from-green-600 to-emerald-600 text-white font-extrabold hover:from-green-700 hover:to-emerald-700 transition">+ Ø¥Ø¶Ø§ÙØ© ÙØ¹Ø§Ù„ÙŠØ©</button>

  <script>
    const months = ['ÙƒØ§Ù†ÙˆÙ† Ø§Ù„Ø«Ø§Ù†ÙŠ','Ø´Ø¨Ø§Ø·','Ø¢Ø°Ø§Ø±','Ù†ÙŠØ³Ø§Ù†','Ø£ÙŠØ§Ø±','Ø­Ø²ÙŠØ±Ø§Ù†','ØªÙ…ÙˆØ²','Ø¢Ø¨','Ø£ÙŠÙ„ÙˆÙ„','ØªØ´Ø±ÙŠÙ† Ø§Ù„Ø£ÙˆÙ„','ØªØ´Ø±ÙŠÙ† Ø§Ù„Ø«Ø§Ù†ÙŠ','ÙƒØ§Ù†ÙˆÙ† Ø§Ù„Ø£ÙˆÙ„'];
    const daysNames = ['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª'];

    let current = new Date();
    let selectedDay = null;
    let events = {}; // { "YYYY-M-D": ["...","..."] }

    // (hash sync removed)

    
    // --- storage via events.json ---
    let gh = {user:'', repo:'', token:'', enabled:false, sha:null};

    async function loadFromFile(){
      try{
        const res = await fetch('events.json', {cache:'no-store'});
        if(res.ok){
          const data = await res.json();
          if(data && typeof data==='object'){ events = data; }
        }
      }catch(e){ console.log('no events.json yet'); }
    }

    async function fetchShaIfExists(){
      if(!gh.enabled) return null;
      try{
        const r = await fetch(`https://api.github.com/repos/${gh.user}/${gh.repo}/contents/events.json`, {
          headers:{'Authorization':`token ${gh.token}`,'Accept':'application/vnd.github.v3+json'}
        });
        if(r.ok){
          const j = await r.json();
          gh.sha = j.sha;
          return gh.sha;
        }
      }catch(e){}
      return null;
    }

    async function saveToGithub(){
      if(!gh.enabled) { alert('ÙØ¹Ù‘Ù„ Ø§Ù„Ø­ÙØ¸ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£ÙˆÙ„Ø§Ù‹.'); return; }
      try{
        const content = btoa(unescape(encodeURIComponent(JSON.stringify(events,null,2))));
        // ensure SHA
        await fetchShaIfExists();
        const r = await fetch(`https://api.github.com/repos/${gh.user}/${gh.repo}/contents/events.json`, {
          method:'PUT',
          headers:{
            'Authorization':`token ${gh.token}`,
            'Accept':'application/vnd.github.v3+json',
            'Content-Type':'application/json'
          },
          body:JSON.stringify({message:'ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚ÙˆÙŠÙ…', content, sha: gh.sha || undefined})
        });
        if(r.ok){ const j = await r.json(); gh.sha = j.content.sha; alert('âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¥Ù„Ù‰ events.json'); }
        else { const e = await r.json(); alert('âŒ ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸: '+(e.message||'')); }
      }catch(e){ alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: '+e.message); }
    }

    // --- UI helpers ---
    function keyFor(y,m,d){ return `${y}-${m}-${d}`; } // month is 0-based
    function openPanel(day){
      selectedDay = day;
      document.getElementById('panel').classList.remove('hidden');
      const m = current.getMonth();
      document.getElementById('panelTitle').textContent = `ÙØ¹Ø§Ù„ÙŠØ§Øª ÙŠÙˆÙ… ${day} ${months[m]}`;
      const inp = document.getElementById('input'); inp.value=''; inp.focus();
      render();
    }
    function closePanel(){ selectedDay = null; document.getElementById('panel').classList.add('hidden'); render(); }

    // --- render ---
    function render(){
      const y = current.getFullYear(), m = current.getMonth();
      document.getElementById('title').textContent = `${months[m]} ${y}`;

      const grid = document.getElementById('grid');
      grid.innerHTML='';

      const first = new Date(y,m,1);
      const last = new Date(y,m+1,0);
      const today = new Date();
      // Build list of Sun..Thu days
      const days = [];
      for(let d=1; d<=last.getDate(); d++){
        const dow = new Date(y,m,d).getDay();
        if(dow>=0 && dow<=4) days.push(d);
      }
      // Render every day in order, grid takes care of rows
      for(const d of days){
        const k = keyFor(y,m,d);
        const isToday = (d===today.getDate() && m===today.getMonth() && y===today.getFullYear());
        const isSelected = (d===selectedDay);

        const cell = document.createElement('div');
        cell.className = 'day-cell' + (isToday ? ' today' : '') + (isSelected && !isToday ? ' selected' : '');

        const num = document.createElement('div');
        num.className = 'day-number';
        num.textContent = d;
        cell.appendChild(num);

        const list = document.createElement('div');
        list.className = 'events';

        const arr = events[k] || [];
        for(let i=0;i<arr.length;i++){
          const wrap = document.createElement('div');
          wrap.className = 'event';
          const span = document.createElement('span');
          span.textContent = arr[i];
          span.className = 'flex-1';
          const del = document.createElement('button');
          del.className = 'del';
          del.textContent = 'âœ•';
          del.onclick = async (e)=>{ e.stopPropagation(); arr.splice(i,1); if(arr.length===0) delete events[k]; else events[k]=arr; if(gh.enabled){ await saveToGithub(); } render(); };
          wrap.appendChild(span); wrap.appendChild(del);
          list.appendChild(wrap);
        }
        cell.appendChild(list);
        cell.onclick = ()=>openPanel(d);
        grid.appendChild(cell);
      }
      // datetime
      const now = new Date();
      const dd = String(now.getDate()).padStart(2,'0');
      const mm = String(now.getMonth()+1).padStart(2,'0');
      const yy = String(now.getFullYear()).slice(-2);
      document.getElementById('now-date').textContent = `${dd}/${mm}/${yy}`;
      document.getElementById('now-day').textContent = daysNames[now.getDay()];
      const hh = String(now.getHours()).padStart(2,'0');
      const mi = String(now.getMinutes()).padStart(2,'0');
      const ss = String(now.getSeconds()).padStart(2,'0');
      document.getElementById('now-time').textContent = `${hh}:${mi}:${ss}`;
    }

    setInterval(()=>{
      const now = new Date();
      const dd = String(now.getDate()).padStart(2,'0');
      const mm = String(now.getMonth()+1).padStart(2,'0');
      const yy = String(now.getFullYear()).slice(-2);
      document.getElementById('now-date').textContent = `${dd}/${mm}/${yy}`;
      document.getElementById('now-day').textContent = daysNames[now.getDay()];
      const hh = String(now.getHours()).padStart(2,'0');
      const mi = String(now.getMinutes()).padStart(2,'0');
      const ss = String(now.getSeconds()).padStart(2,'0');
      document.getElementById('now-time').textContent = `${hh}:${mi}:${ss}`;
    },1000);

    
    // settings
    const settings = document.getElementById('settings');
    document.getElementById('openSettings').onclick = ()=>{ settings.classList.remove('hidden'); };
    document.getElementById('closeSettings').onclick = ()=>{ settings.classList.add('hidden'); };
    document.getElementById('testConn').onclick = async ()=>{
      const u = document.getElementById('ghUser').value.trim();
      const r = document.getElementById('ghRepo').value.trim();
      const t = document.getElementById('ghToken').value.trim();
      if(!u||!r||!t){ alert('Ø§Ù…Ù„Ø£ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹'); return; }
      try{
        const res = await fetch(`https://api.github.com/repos/${u}/${r}`, {headers:{'Authorization':`token ${t}`}});
        if(res.ok){ alert('âœ… Ø§Ù„Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­'); } else { const e = await res.json(); alert('âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„: '+(e.message||'')); }
      }catch(e){ alert('âŒ Ø®Ø·Ø£: '+e.message); }
    };
    document.getElementById('enableSave').onclick = ()=>{
      gh.user = document.getElementById('ghUser').value.trim();
      gh.repo = document.getElementById('ghRepo').value.trim();
      gh.token = document.getElementById('ghToken').value.trim();
      if(!gh.user||!gh.repo||!gh.token){ alert('Ø§Ù…Ù„Ø£ Ø§Ù„Ø­Ù‚ÙˆÙ„'); return; }
      gh.enabled = true;
      settings.classList.add('hidden');
      alert('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø¶Ø§ÙØ©/Ø§Ù„Ø­Ø°Ù');
    };

    // manual save
    document.getElementById('saveNow').onclick = saveToGithub;

    // --- actions ---
    document.getElementById('prev').onclick = ()=>{ current = new Date(current.getFullYear(), current.getMonth()-1, 1); closePanel(); };
    document.getElementById('next').onclick = ()=>{ current = new Date(current.getFullYear(), current.getMonth()+1, 1); closePanel(); };

    document.getElementById('addBtn').onclick = ()=>{
      if(!selectedDay) return;
      const txt = document.getElementById('input').value.trim();
      if(!txt) return;
      const y = current.getFullYear(), m = current.getMonth();
      const k = keyFor(y,m,selectedDay);
      if(!events[k]) events[k]=[];
      events[k].push(txt);
      if(gh.enabled){ await saveToGithub(); }
      document.getElementById('input').value='';
      render();
    };
    document.getElementById('input').addEventListener('keypress', (e)=>{
      if(e.key==='Enter'){ document.getElementById('addBtn').click(); }
    });
    document.getElementById('done').onclick = closePanel;

    document.getElementById('fab').onclick = ()=>{
      const t = new Date();
      if(current.getFullYear()!==t.getFullYear() || current.getMonth()!==t.getMonth()){
        current = new Date(t.getFullYear(), t.getMonth(), 1);
      }
      openPanel(t.getDate());
    };

    // removed copyLink = async ()=>{
      saveToHash();
      try{ await navigator.clipboard.writeText(location.href); alert('âœ… ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.'); }
      catch(e){
        const i=document.createElement('input'); i.value=location.href; document.body.appendChild(i); i.select(); document.execCommand('copy'); document.body.removeChild(i);
        alert('âœ… ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.');
      }
    };

    // initial
    (async()=>{ await loadFromFile(); render(); })();
  </script>
</body>
</html>
