<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ØªÙ‚ÙˆÙŠÙ… Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª (Ø§Ù„Ø£Ø­Ø¯â€“Ø§Ù„Ø®Ù…ÙŠØ³) â€” ÙˆØ¶Ø¹ GitHub Pages Ø¨Ø¯ÙˆÙ† PHP</title>
  <style>
    :root{
      --bg:#0f172a; --panel:#111827; --muted:#94a3b8; --text:#e5e7eb; --brand:#22c55e; --accent:#38bdf8; --danger:#ef4444; --ring:rgba(56,189,248,.35);
    }
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#0b1220,#0f172a);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Naskh Arabic",Tahoma,sans-serif}
    .container{max-width:1100px;margin-inline:auto;padding:24px}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:12px}
    .now{display:flex;flex-direction:column;gap:4px}
    .now .date{font-size:1.1rem;font-weight:700}
    .now .time{font-variant-numeric:tabular-nums;color:var(--muted)}
    .nav{display:flex;align-items:center;gap:8px}
    button{background:var(--panel);color:var(--text);border:1px solid #1f2937;border-radius:12px;padding:8px 12px;cursor:pointer}
    button:hover{outline:2px solid var(--ring)}
    .month-title{font-size:1.15rem;font-weight:800}
    .calendar{background:rgba(255,255,255,0.03);border:1px solid #1e293b;border-radius:16px;overflow:hidden}
    .weekdays,.grid{display:grid;grid-template-columns:repeat(5,1fr)}
    .weekdays{background:rgba(255,255,255,.04);color:var(--muted);text-align:center;font-weight:700}
    .weekdays div{padding:10px 6px;border-inline-start:1px solid #1f2937}
    .weekdays div:first-child{border-inline-start:none}
    .grid{gap:10px;padding:12px}
    .day{min-height:110px;background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01));border:1px solid #1f2937;border-radius:14px;padding:10px;display:flex;flex-direction:column;gap:8px;position:relative}
    .day.today{border-color:var(--accent);box-shadow:0 0 0 2px var(--ring) inset}
    .day .num{font-weight:900}
    .events{display:flex;flex-direction:column;gap:6px}
    .event-chip{background:#0b3a2a;border:1px solid #14532d;color:#bef264;padding:6px 8px;border-radius:10px;font-size:.85rem;line-height:1.2;word-wrap:break-word}
    .add{position:absolute;inset-inline-end:8px;inset-block-end:8px;background:var(--brand);color:#002b10;border:none;padding:6px 10px;border-radius:999px;font-weight:800}
    .toolbar{display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin-top:10px;color:var(--muted)}
    .status{margin-inline-start:auto;color:var(--muted);font-size:.9rem}
    dialog{border:none;border-radius:16px;padding:0;max-width:520px;width:92vw;background:#0b1220;color:var(--text)}
    .modal{padding:16px;display:flex;flex-direction:column;gap:12px}
    input,textarea{width:100%;background:#0a0f1a;border:1px solid #1f2937;color:var(--text);border-radius:10px;padding:10px}
    .modal .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .modal .actions{display:flex;gap:8px;justify-content:flex-start}
    .muted{color:var(--muted)}
    .help{font-size:.9rem;color:var(--muted)}
    .empty{color:#6b7280;font-style:italic}
    .pill{border:1px dashed #334155;border-radius:999px;padding:6px 10px}
    @media (max-width:700px){.day{min-height:100px}.weekdays div{font-size:.9rem}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="now">
        <div class="date" id="currentDate"></div>
        <div class="time" id="currentTime"></div>
      </div>
      <div class="nav">
        <button id="prevBtn" title="Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚">â—€</button>
        <div class="month-title" id="monthTitle"></div>
        <button id="nextBtn" title="Ø§Ù„Ø´Ù‡Ø± Ø§Ù„ØªØ§Ù„ÙŠ">â–¶</button>
      </div>
    </header>

    <section class="calendar">
      <div class="weekdays">
        <div>Ø§Ù„Ø£Ø­Ø¯</div><div>Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†</div><div>Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</div><div>Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</div><div>Ø§Ù„Ø®Ù…ÙŠØ³</div>
      </div>
      <div id="grid" class="grid"></div>
    </section>

    <div class="toolbar">
      <span class="pill">ÙˆØ¶Ø¹ Ø¨Ø¯ÙˆÙ† Ø®Ø§Ø¯Ù… (GitHub Pages): Ù„Ù„Ø­ÙØ¸ Ø§Ø³ØªØ®Ø¯Ù… Ù…Ù„Ù <code>events.json</code> Ù…Ø­Ù„ÙŠ/Ø³Ø­Ø§Ø¨ÙŠ.</span>
      <button id="pickFile">ğŸ“‚ Ø§Ø®ØªØ±/Ø£Ù†Ø´Ø¦ Ù…Ù„Ù Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øªâ€¦</button>
      <button id="importBtn">â¬†ï¸ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù„Ù (Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø·)</button>
      <button id="exportBtn">â¬‡ï¸ ØªØµØ¯ÙŠØ± ÙƒÙ€ JSON</button>
      <button id="testBtn">ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø­ÙØ¸</button>
      <span class="status" id="status">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ù Ù…Ø±ØªØ¨Ø· Ø¨Ø¹Ø¯</span>
    </div>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ ÙØ¹Ø§Ù„ÙŠØ© -->
  <dialog id="eventDialog">
    <form method="dialog" class="modal" id="eventForm">
      <h3 style="margin:0">Ø¥Ø¯Ø§Ø±Ø© ÙØ¹Ø§Ù„ÙŠØ© Ù„Ù„ÙŠÙˆÙ…: <span id="dlgDate" class="muted"></span></h3>
      <div class="row">
        <div>
          <label class="muted">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
          <input id="evtTitle" placeholder="Ù…Ø«Ø§Ù„: Ø±Ø­Ù„Ø© ØµÙÙŠØ©" required />
        </div>
        <div>
          <label class="muted">Ø§Ù„ÙˆÙ‚Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <input id="evtTime" type="time" />
        </div>
      </div>
      <div>
        <label class="muted">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
        <textarea id="evtNotes" rows="4" placeholder="ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©..."></textarea>
      </div>
      <div class="actions">
        <button value="cancel">Ø¥Ù„ØºØ§Ø¡</button>
        <button id="saveBtn" value="default" style="background:var(--accent);border-color:#075985">Ø­ÙØ¸</button>
        <button id="deleteBtn" type="button" style="background:var(--danger);border-color:#7f1d1d">Ø­Ø°Ù</button>
      </div>
      <div class="help">ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙˆØ¶Ø¹: Ø§Ù„Ø­ÙØ¸ ÙŠØªÙ… Ø¥Ù„Ù‰ Ù…Ù„Ù ØªØ®ØªØ§Ø±Ù‡ Ø¹Ø¨Ø± Ø§Ù„Ù…ØªØµÙØ­. Ø¶Ø¹ Ø§Ù„Ù…Ù„Ù Ø¯Ø§Ø®Ù„ Ù…Ø¬Ù„Ø¯ Ø³Ø­Ø§Ø¨ÙŠ (Dropbox/Drive/OneDrive) Ù„Ùˆ Ø£Ø±Ø¯Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¨ÙŠÙ† Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©.</div>
    </form>
  </dialog>

  <script>
    // ======= ÙˆØ¶Ø¹ GitHub Pages: Ø¨Ø¯ÙˆÙ† PHP â€” Ù…Ø²ÙˆØ¯ ØªØ®Ø²ÙŠÙ† Ù‚Ø§Ø¦Ù… Ø¹Ù„Ù‰ Ù…Ù„Ù Ù…Ø­Ù„ÙŠ Ø¹Ø¨Ø± File System Access API =======

    // Ø§Ù„Ø­Ø§Ù„Ø©
    const state = {
      viewYear: (new Date()).getFullYear(),
      viewMonth: (new Date()).getMonth(),
      events: {},            // { 'YYYY-MM-DD': [ {title,time,notes} ] }
      fileHandle: null,      // FileSystemFileHandle Ù„Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
      fileName: 'events.json'
    };

    const fmtMonth = (y, m) => new Date(y, m, 1).toLocaleDateString('ar-EG',{month:'long', year:'numeric'});
    const toISO = (d) => new Date(d.getFullYear(), d.getMonth(), d.getDate()).toISOString().slice(0,10);

    // Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ø­ÙŠØ©
    function tickNow(){
      const now = new Date();
      document.getElementById('currentDate').textContent = now.toLocaleDateString('ar-EG',{weekday:'long', day:'2-digit', month:'long', year:'numeric'});
      document.getElementById('currentTime').textContent = now.toLocaleTimeString('ar-EG',{hour:'2-digit', minute:'2-digit', second:'2-digit'});
    }
    tickNow(); setInterval(tickNow, 1000);

    // ØªØ­Ù…ÙŠÙ„ Ø£ÙˆÙ„ÙŠ: Ø¬Ø±Ù‘Ø¨ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Ø«Ø§Ø¨Øª events.json (Ø¥Ù† ÙˆÙØ¬Ø¯ Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ù„ØµÙØ­Ø© â€” Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø·)
    async function bootstrapLoad(){
      try{
        const res = await fetch('events.json', {cache:'no-store'});
        if(res.ok){
          const data = await res.json();
          if(data && typeof data === 'object') state.events = data;
        }
      }catch(_){/* ØªØ¬Ø§Ù‡Ù„ */}
    }

    // Ø­ÙØ¸ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø®ØªØ§Ø± Ø¹Ø¨Ø± File System Access API
    async function saveToFile(){
      if(!state.fileHandle){ throw new Error('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ù Ù…Ø±ØªØ¨Ø·. Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± "Ø§Ø®ØªØ±/Ø£Ù†Ø´Ø¦ Ù…Ù„Ù Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øªâ€¦"'); }
      const writable = await state.fileHandle.createWritable();
      await writable.write(new Blob([JSON.stringify(state.events, null, 2)], {type:'application/json'}));
      await writable.close();
      setStatus('ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¥Ù„Ù‰ '+(state.fileHandle.name || state.fileName));
    }

    // Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù/Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù
    async function pickFile(){
      if(!('showOpenFilePicker' in window || 'showSaveFilePicker' in window)){
        alert('Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… File System Access API. Ø§Ø³ØªØ®Ø¯Ù… ÙƒØ±ÙˆÙ…/Ø¥ÙŠØ¯Ø¬ Ø­Ø¯ÙŠØ« Ø£Ùˆ Ø§Ø³ØªÙˆØ±Ø¯/ØµØ¯Ø± ÙŠØ¯ÙˆÙŠÙ‹Ø§.');
        return;
      }
      try{
        // Ø­Ø§ÙˆÙ„ ÙØªØ­ Ù…Ù„Ù Ù…ÙˆØ¬ÙˆØ¯
        const [handle] = await window.showOpenFilePicker({
          multiple:false,
          types:[{description:'Events JSON', accept:{'application/json':['.json']}}]
        });
        state.fileHandle = handle;
        const file = await handle.getFile();
        const text = await file.text();
        state.events = JSON.parse(text || '{}') || {};
        setStatus('Ù…Ø±ØªØ¨Ø· Ø¨Ø§Ù„Ù…Ù„Ù: '+(handle.name || 'events.json'));
        render();
      }catch(err){
        if(err && err.name === 'AbortError') return;
        // Ø¥Ù† Ù„Ù… ÙŠØ®ØªØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù„ÙÙ‹Ø§ØŒ Ø§Ø³Ù…Ø­ Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙŠØ¯
        if('showSaveFilePicker' in window){
          try{
            const handle = await window.showSaveFilePicker({
              suggestedName: state.fileName,
              types:[{description:'Events JSON', accept:{'application/json':['.json']}}]
            });
            state.fileHandle = handle;
            await saveToFile(); // ÙŠÙ†Ø´Ø¦ Ù…Ù„ÙÙ‹Ø§ ÙØ§Ø±ØºÙ‹Ø§ Ù…Ø¹ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            setStatus('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯: '+(handle.name||state.fileName));
          }catch(_e){ /* ØªØ¬Ø§Ù‡Ù„ */ }
        }
      }
    }

    // Ø§Ø³ØªÙŠØ±Ø§Ø¯/ØªØµØ¯ÙŠØ± (Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø· Ø£Ùˆ ØªÙ†Ø²ÙŠÙ„)
    async function importJSON(){
      try{
        const [handle] = await window.showOpenFilePicker({multiple:false, types:[{description:'Events JSON', accept:{'application/json':['.json']}}]});
        const file = await handle.getFile();
        const data = JSON.parse(await file.text() || '{}') || {};
        if(typeof data !== 'object') throw new Error('Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­');
        state.events = data;
        render();
        setStatus('ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† '+(handle.name||'Ù…Ù„Ù'));
      }catch(e){ if(e?.name!=='AbortError') alert('ÙØ´Ù„ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯: '+e.message); }
    }
    function exportJSON(){
      const blob = new Blob([JSON.stringify(state.events, null, 2)],{type:'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = state.fileName;
      a.click();
      URL.revokeObjectURL(a.href);
      setStatus('ØªÙ… ØªÙ†Ø²ÙŠÙ„ Ù†Ø³Ø®Ø© Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
    }

    function setStatus(msg){ document.getElementById('status').textContent = msg; }

    // Ø±Ø³Ù… Ø´Ø¨ÙƒØ© Ø§Ù„Ø£Ø­Ø¯â†’Ø§Ù„Ø®Ù…ÙŠØ³
    function render(){
      document.getElementById('monthTitle').textContent = fmtMonth(state.viewYear, state.viewMonth);
      const grid = document.getElementById('grid'); grid.innerHTML = '';
      const last = new Date(state.viewYear, state.viewMonth + 1, 0);
      const todayISO = toISO(new Date());
      for(let day=1; day<=last.getDate(); day++){
        const d = new Date(state.viewYear, state.viewMonth, day);
        const dow = d.getDay(); // 0=Ø§Ù„Ø£Ø­Ø¯ ÙÙŠ JSØŸ Ù„Ø§: JS 0=Ø§Ù„Ø£Ø­Ø¯ ÙØ¹Ù„Ø§Ù‹.
        if(dow===5 || dow===6) continue; // Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ø§Ù„Ø¬Ù…Ø¹Ø© (5) ÙˆØ§Ù„Ø³Ø¨Øª (6)
        const iso = toISO(d);
        const cell = document.createElement('div');
        cell.className = 'day'+(iso===todayISO?' today':'');
        const num = document.createElement('div'); num.className='num'; num.textContent = day.toString().padStart(2,'0');
        const list = document.createElement('div'); list.className='events';
        const evts = state.events[iso] || [];
        if(evts.length){ evts.forEach(e=>{const chip=document.createElement('div'); chip.className='event-chip'; chip.textContent=(e.time?(e.time+' â€” '):'')+e.title; chip.title=e.notes||''; list.appendChild(chip);}); }
        else { const empty=document.createElement('div'); empty.className='empty'; empty.textContent='Ù„Ø§ ÙØ¹Ø§Ù„ÙŠØ§Øª'; list.appendChild(empty); }
        const btn = document.createElement('button'); btn.className='add'; btn.type='button'; btn.textContent='+';
        btn.addEventListener('click', ()=> openDialog(iso));
        cell.addEventListener('click', (ev)=>{ if(ev.target===btn) return; openDialog(iso); });
        cell.append(num,list,btn); grid.appendChild(cell);
      }
    }

    // Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø§Ø±Ø© ÙØ¹Ø§Ù„ÙŠØ©
    const dlg = document.getElementById('eventDialog');
    const dlgDate = document.getElementById('dlgDate');
    const evtTitle = document.getElementById('evtTitle');
    const evtTime  = document.getElementById('evtTime');
    const evtNotes = document.getElementById('evtNotes');
    const deleteBtn = document.getElementById('deleteBtn');

    let activeISO = null; let activeIndex = null;

    function openDialog(iso){
      activeISO = iso; activeIndex = null;
      dlgDate.textContent = new Date(iso).toLocaleDateString('ar-EG',{weekday:'long', day:'2-digit', month:'long', year:'numeric'});
      const list = state.events[iso] || [];
      if(list.length){ activeIndex=0; evtTitle.value=list[0].title||''; evtTime.value=list[0].time||''; evtNotes.value=list[0].notes||''; }
      else { evtTitle.value=''; evtTime.value=''; evtNotes.value=''; }
      dlg.showModal();
    }

    deleteBtn.addEventListener('click', async ()=>{
      if(!activeISO) return;
      const list = state.events[activeISO] || [];
      if(activeIndex!=null) list.splice(activeIndex,1);
      if(list.length===0) delete state.events[activeISO]; else state.events[activeISO]=list;
      try{ await saveToFile(); }catch(e){ alert('ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸: '+e.message); }
      render(); dlg.close();
    });

    document.getElementById('eventForm').addEventListener('submit', async (e)=>{
      e.preventDefault(); if(!activeISO) return;
      const entry = {title: evtTitle.value.trim(), time: (evtTime.value||'').trim(), notes: (evtNotes.value||'').trim()};
      if(!entry.title){ dlg.close(); return; }
      const list = state.events[activeISO] || [];
      if(activeIndex!=null){ list[activeIndex]=entry; } else { list.push(entry); }
      state.events[activeISO]=list;
      try{ await saveToFile(); }catch(err){ alert('ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸: '+err.message+"
Ø§Ø®ØªØ± Ù…Ù„ÙÙ‹Ø§ Ù„Ù„Ø­ÙØ¸ Ø¹Ø¨Ø± Ø§Ù„Ø²Ø± ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ·."); }
      render(); dlg.close();
    });

    // ØªÙ†Ù‚Ù„ Ø§Ù„Ø£Ø´Ù‡Ø±
    document.getElementById('prevBtn').addEventListener('click', ()=>{ const m=state.viewMonth-1; if(m<0){state.viewMonth=11;state.viewYear-=1;} else state.viewMonth=m; render(); });
    document.getElementById('nextBtn').addEventListener('click', ()=>{ const m=state.viewMonth+1; if(m>11){state.viewMonth=0;state.viewYear+=1;} else state.viewMonth=m; render(); });

    // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ø¯ÙˆØ§Øª
    document.getElementById('pickFile').addEventListener('click', pickFile);
    document.getElementById('importBtn').addEventListener('click', importJSON);
    document.getElementById('exportBtn').addEventListener('click', exportJSON);
    document.getElementById('testBtn').addEventListener('click', async ()=>{
      // Ø§Ø®ØªØ¨Ø§Ø±: Ø£Ø¶Ù ÙØ¹Ø§Ù„ÙŠØ© ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„ÙŠÙˆÙ… ÙˆØ§Ø­ÙØ¸
      const iso = toISO(new Date());
      const note = 'Ø§Ø®ØªØ¨Ø§Ø± Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ â€” ÙŠÙÙ…ÙƒÙ†Ùƒ Ø­Ø°ÙÙ‡ Ù„Ø§Ø­Ù‚Ù‹Ø§';
      state.events[iso] = [{title:'ğŸ§ª Test Event', time:new Date().toLocaleTimeString('ar-EG',{hour:'2-digit',minute:'2-digit'}), notes:note}];
      try{ await saveToFile(); setStatus('âœ… Ù†Ø¬Ø­ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: ØªÙ… Ø§Ù„Ø­ÙØ¸'); render(); }
      catch(e){ alert('âŒ ÙØ´Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: '+e.message); setStatus('ÙØ´Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: '+e.message); }
    });

    (async function init(){ await bootstrapLoad(); render(); })();
  </script>
</body>
</html>
