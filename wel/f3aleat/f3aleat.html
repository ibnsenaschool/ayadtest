<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ألبوم الصور والفيديو — ملف JSON</title>
  <meta name="color-scheme" content="light dark" />
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{--bg:#000;--fg:#fff;--glass:rgba(255,255,255,.2);--line:rgba(255,255,255,.25)}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--fg);overflow:hidden}

    .slideshow-container{position:relative;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center}
    .slide{display:none;position:absolute;inset:0;animation:fadeIn 1s}
    .slide.active{display:block}
    .slide img,.slide video{width:100%;height:100%;object-fit:cover}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}

    .top-bar{position:absolute;top:15px;left:0;right:0;display:flex;align-items:center;justify-content:center;z-index:10}

    .center-title{background:rgba(0,0,0,.55);backdrop-filter:blur(6px);padding:14px 22px;border-radius:16px;font-weight:700;letter-spacing:.3px;box-shadow:0 6px 30px rgba(0,0,0,.25);text-align:center;color:#fff}
    .center-title span{display:block;font-size:clamp(18px,4vw,32px)}

    .logo-left{position:absolute;top:10px;left:10px;width:80px;height:auto;border-radius:8px;box-shadow:0 0 10px rgba(0,0,0,.4);z-index:11}
    .logo-right{position:absolute;top:10px;right:10px;width:80px;height:auto;border-radius:8px;box-shadow:0 0 10px rgba(0,0,0,.4);z-index:11}

    .photo-info{position:absolute;bottom:20px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.7);padding:10px 16px;border-radius:10px;text-align:center;backdrop-filter:blur(6px)}
    .photo-info h2{font-size:1.1rem;margin-bottom:6px}
    .photo-info p{font-size:.95rem;opacity:.85}

    .nav-btn{position:absolute;top:50%;transform:translateY(-50%);background:var(--glass);border:none;color:white;font-size:42px;padding:14px 18px;cursor:pointer;border-radius:12px;transition:.2s;backdrop-filter:blur(6px)}
    .nav-btn:hover{background:rgba(255,255,255,.35)}
    .prev{left:16px}
    .next{right:16px}

    .controls{position:absolute;top:20px;right:110px;display:flex;gap:10px;align-items:center;z-index:12}
    .control-btn{background:var(--glass);border:2px solid var(--line);color:#fff;padding:10px 14px;border-radius:10px;cursor:pointer;transition:.2s;backdrop-filter:blur(6px)}
    .control-btn:hover{transform:scale(1.04)}

    .settings{position:absolute;top:68px;right:16px;background:rgba(0,0,0,.8);padding:12px;border-radius:10px;display:none;backdrop-filter:blur(8px)}
    .settings.show{display:block}
    .settings label{display:block;margin-bottom:8px}
    .settings input{width:200px}
  </style>
</head>
<body>
  <div class="slideshow-container" id="container">
    <div id="slides"></div>

    <button class="nav-btn prev" id="btnPrev">&#10094;</button>
    <button class="nav-btn next" id="btnNext">&#10095;</button>

    <div class="top-bar">
      <img class="logo-left" src="https://ibnsenaschool.github.io/ayadtest/wel/f3aleat/ibnsena.jpg" alt="شعار ابن سينا" />
      <div class="center-title" id="centerTitle"><span>يوم الزيت والزيتون - مدرسة ابن سينا</span></div>
      <img class="logo-right" src="https://ibnsenaschool.github.io/ayadtest/wel/f3aleat/ibnsena2.jpg" alt="شعار ابن سينا 2" />
    </div>

    <div class="photo-info">
      <h2 id="photoTitle">جاري التحميل...</h2>
      <p id="photoCounter">0 / 0</p>
    </div>
  </div>

  <div class="controls">
    <button class="control-btn" id="playBtn">⏸️ إيقاف</button>
    <button class="control-btn" id="gearBtn">⚙️ الإعدادات</button>
  </div>
  <div class="settings" id="settings">
    <label>
      مدة العرض (بالثواني):
      <input type="range" min="1" max="10" value="3" id="speedInput">
      <span id="speedValue">3</span>
    </label>
  </div>

  <script>
    const slidesEl = document.getElementById('slides');
    const titleEl = document.getElementById('photoTitle');
    const countEl = document.getElementById('photoCounter');
    const playBtn = document.getElementById('playBtn');
    const gearBtn = document.getElementById('gearBtn');
    const settings = document.getElementById('settings');
    const speedInput = document.getElementById('speedInput');
    const speedValue = document.getElementById('speedValue');

    let items = [];
    let current = 0;
    let playing = true;
    let slideMs = 3000;
    let slideTimer = null;

    try {
      const saved = +localStorage.getItem('olive_album_speed');
      if (!isNaN(saved)) {
        speedInput.value = String(saved);
        slideMs = saved * 1000;
        speedValue.textContent = String(saved);
      }
    } catch {}

    function setPlaying(on) {
      playing = on;
      playBtn.textContent = on ? '⏸️ إيقاف' : '▶️ تشغيل';
      if (on) startAuto(); else stopAuto();
    }
    function startAuto() { stopAuto(); slideTimer = setInterval(() => autoAdvance(), slideMs); }
    function stopAuto() { if (slideTimer) { clearInterval(slideTimer); slideTimer = null; } }

    function autoAdvance() {
      const activeSlide = document.querySelector('.slide.active');
      const video = activeSlide ? activeSlide.querySelector('video') : null;
      if (video) {
        if (video.paused) { video.play().catch(()=>{}); return; }
        if (!video.ended) return;
      }
      changeSlide(1);
    }

    function togglePlay() { setPlaying(!playing); }
    function toggleSettings() { settings.classList.toggle('show'); }

    speedInput.addEventListener('input', () => {
      const v = Math.max(1, Math.min(10, +speedInput.value || 3));
      speedValue.textContent = v;
      slideMs = v * 1000;
      localStorage.setItem('olive_album_speed', String(v));
      if (playing) startAuto();
    });

    document.getElementById('btnPrev').addEventListener('click', () => { changeSlide(-1); if (playing) startAuto(); });
    document.getElementById('btnNext').addEventListener('click', () => { changeSlide(1); if (playing) startAuto(); });
    playBtn.addEventListener('click', togglePlay);
    gearBtn.addEventListener('click', toggleSettings);

    async function loadImages() {
      try {
        const response = await fetch('images.json');
        const data = await response.json();
        return data.images.map(name => ({
          type: /\.mp4$/i.test(name) ? 'video' : 'img',
          src: name,
          name: name
        }));
      } catch (e) {
        console.error('خطأ في تحميل ملف JSON:', e);
        return [];
      }
    }

    function buildSlides() {
      slidesEl.innerHTML = '';
      items.forEach((it, idx) => {
        const slide = document.createElement('div');
        slide.className = 'slide' + (idx === 0 ? ' active' : '');
        if (it.type === 'video') {
          const v = document.createElement('video');
          v.src = it.src;
          v.controls = true;
          v.autoplay = false;
          v.playsInline = true;
          v.preload = 'auto';
          slide.appendChild(v);
        } else {
          const im = document.createElement('img');
          im.src = it.src;
          im.alt = it.name;
          slide.appendChild(im);
        }
        slidesEl.appendChild(slide);
      });
    }

    function showSlide(index) {
      const slides = document.querySelectorAll('.slide');
      slides.forEach(s => s.classList.remove('active'));
      slides[index]?.classList.add('active');
      current = index;
      titleEl.textContent = items[index].name;
      countEl.textContent = `${index + 1} / ${items.length}`;

      const activeSlide = document.querySelector('.slide.active');
      const vid = activeSlide ? activeSlide.querySelector('video') : null;
      if (vid) { vid.play().catch(()=>{}); }
    }

    function changeSlide(dir) {
      if (!items.length) return;
      let ni = current + dir;
      if (ni >= items.length) ni = 0;
      else if (ni < 0) ni = items.length - 1;
      showSlide(ni);
    }

    (async function init() {
      items = await loadImages();
      if (!items.length) {
        titleEl.textContent = 'لم يتم العثور على صور في ملف images.json';
        countEl.textContent = '0 / 0';
        return;
      }
      buildSlides();
      showSlide(0);
      setPlaying(true);
    })();
  </script>
</body>
</html>
