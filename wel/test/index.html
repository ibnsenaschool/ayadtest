<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงุฎุชุจุงุฑ ุงููุฑุงุกุฉ ุงูุตูุชู - Voice Reading Test</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel Standalone for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap');
        
        body {
            font-family: 'Cairo', sans-serif;
        }
        
        @keyframes pulse-ring {
            0% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
            }
            50% {
                box-shadow: 0 0 0 20px rgba(59, 130, 246, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
            }
        }
        
        .pulse-ring {
            animation: pulse-ring 2s infinite;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Icons Components (simplified Lucide icons)
        const MicIcon = () => (
            <svg className="w-16 h-16 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/>
                <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                <line x1="12" x2="12" y1="19" y2="22"/>
            </svg>
        );
        
        const MicOffIcon = () => (
            <svg className="w-16 h-16 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="2" x2="22" y1="2" y2="22"/>
                <path d="M18.89 13.23A7.12 7.12 0 0 0 19 12v-2"/>
                <path d="M5 10v2a7 7 0 0 0 12 5"/>
                <path d="M15 9.34V5a3 3 0 0 0-5.68-1.33"/>
                <path d="M9 9v3a3 3 0 0 0 5.12 2.12"/>
                <line x1="12" x2="12" y1="19" y2="22"/>
            </svg>
        );
        
        const VolumeIcon = () => (
            <svg className="w-5 h-5 text-blue-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
            </svg>
        );
        
        const CheckIcon = () => (
            <svg className="w-6 h-6 text-green-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M20 6 9 17l-5-5"/>
            </svg>
        );
        
        const XIcon = () => (
            <svg className="w-6 h-6 text-red-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="m15 9-6 6"/>
                <path d="m9 9 6 6"/>
            </svg>
        );
        
        const SkipIcon = () => (
            <svg className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polygon points="5 4 15 12 5 20 5 4"/>
                <line x1="19" x2="19" y1="5" y2="19"/>
            </svg>
        );

        const VoiceReadingTest = () => {
            const [words, setWords] = useState([
                'ูุชุงุจ', 'ููู', 'ูุฏุฑุณุฉ', 'ูุนูู', 'ุทุงูุจ', 'ุฏุฑุณ', 'ุตู', 'ุณุจูุฑุฉ',
                'ืกืคืจ', 'ืขื', 'ืืืช ืกืคืจ', 'ืืืจื', 'ืชืืืื', 'ืฉืืขืืจ', 'ืืืชื', 'ืืื'
            ]);
            
            const [currentWordIndex, setCurrentWordIndex] = useState(0);
            const [isListening, setIsListening] = useState(false);
            const [transcript, setTranscript] = useState('');
            const [score, setScore] = useState(0);
            const [attempts, setAttempts] = useState(0);
            const [feedback, setFeedback] = useState(null);
            const [recognition, setRecognition] = useState(null);
            const [browserSupport, setBrowserSupport] = useState(true);

            useEffect(() => {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                
                if (!SpeechRecognition) {
                    setBrowserSupport(false);
                    return;
                }

                const recognitionInstance = new SpeechRecognition();
                recognitionInstance.continuous = false;
                recognitionInstance.interimResults = false;
                
                const currentWord = words[currentWordIndex];
                if (/[\u0600-\u06FF]/.test(currentWord)) {
                    recognitionInstance.lang = 'ar-SA';
                } else if (/[\u0590-\u05FF]/.test(currentWord)) {
                    recognitionInstance.lang = 'he-IL';
                }

                recognitionInstance.onresult = (event) => {
                    const spokenText = event.results[0][0].transcript;
                    setTranscript(spokenText);
                    checkAnswer(spokenText);
                };

                recognitionInstance.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    setIsListening(false);
                    if (event.error === 'no-speech') {
                        setFeedback({ type: 'error', message: 'ูู ูุชู ุณูุงุน ุฃู ุตูุช. ุญุงูู ูุฑุฉ ุฃุฎุฑู.' });
                    } else if (event.error === 'not-allowed') {
                        setFeedback({ type: 'error', message: 'ูุฑุฌู ุงูุณูุงุญ ุจุงุณุชุฎุฏุงู ุงููุงููุฑูููู.' });
                    }
                };

                recognitionInstance.onend = () => {
                    setIsListening(false);
                };

                setRecognition(recognitionInstance);
            }, [currentWordIndex]);

            const startListening = () => {
                if (!recognition) return;
                
                setTranscript('');
                setFeedback(null);
                setIsListening(true);
                
                try {
                    recognition.start();
                } catch (error) {
                    console.error('Error starting recognition:', error);
                }
            };

            const stopListening = () => {
                if (recognition) {
                    recognition.stop();
                }
                setIsListening(false);
            };

            const checkAnswer = (spokenText) => {
                const currentWord = words[currentWordIndex];
                const normalizedSpoken = normalizeText(spokenText);
                const normalizedCorrect = normalizeText(currentWord);
                
                const isCorrect = normalizedSpoken.includes(normalizedCorrect) || 
                                normalizedCorrect.includes(normalizedSpoken) ||
                                calculateSimilarity(normalizedSpoken, normalizedCorrect) > 0.7;

                setAttempts(attempts + 1);

                if (isCorrect) {
                    setScore(score + 1);
                    setFeedback({ 
                        type: 'success', 
                        message: `ููุชุงุฒ! โ ูุฑุฃุช ุงููููุฉ ุจุดูู ุตุญูุญ` 
                    });
                } else {
                    setFeedback({ 
                        type: 'error', 
                        message: `ุญุงูู ูุฑุฉ ุฃุฎุฑู. ุณูุนุช: "${spokenText}"` 
                    });
                }
            };

            const normalizeText = (text) => {
                return text
                    .toLowerCase()
                    .trim()
                    .replace(/[ููููู]/g, '')
                    .replace(/[ืืื]/g, '');
            };

            const calculateSimilarity = (str1, str2) => {
                const longer = str1.length > str2.length ? str1 : str2;
                const shorter = str1.length > str2.length ? str2 : str1;
                
                if (longer.length === 0) return 1.0;
                
                const editDistance = getEditDistance(longer, shorter);
                return (longer.length - editDistance) / longer.length;
            };

            const getEditDistance = (str1, str2) => {
                const matrix = [];
                
                for (let i = 0; i <= str2.length; i++) {
                    matrix[i] = [i];
                }
                
                for (let j = 0; j <= str1.length; j++) {
                    matrix[0][j] = j;
                }
                
                for (let i = 1; i <= str2.length; i++) {
                    for (let j = 1; j <= str1.length; j++) {
                        if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                            matrix[i][j] = matrix[i - 1][j - 1];
                        } else {
                            matrix[i][j] = Math.min(
                                matrix[i - 1][j - 1] + 1,
                                matrix[i][j - 1] + 1,
                                matrix[i - 1][j] + 1
                            );
                        }
                    }
                }
                
                return matrix[str2.length][str1.length];
            };

            const nextWord = () => {
                if (currentWordIndex < words.length - 1) {
                    setCurrentWordIndex(currentWordIndex + 1);
                    setTranscript('');
                    setFeedback(null);
                }
            };

            const speakWord = () => {
                const utterance = new SpeechSynthesisUtterance(words[currentWordIndex]);
                
                if (/[\u0600-\u06FF]/.test(words[currentWordIndex])) {
                    utterance.lang = 'ar-SA';
                } else if (/[\u0590-\u05FF]/.test(words[currentWordIndex])) {
                    utterance.lang = 'he-IL';
                }
                
                utterance.rate = 0.8;
                window.speechSynthesis.speak(utterance);
            };

            const resetTest = () => {
                setCurrentWordIndex(0);
                setScore(0);
                setAttempts(0);
                setTranscript('');
                setFeedback(null);
            };

            if (!browserSupport) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-red-50 to-orange-50 flex items-center justify-center p-4">
                        <div className="bg-white rounded-2xl shadow-xl p-8 max-w-md text-center">
                            <XIcon />
                            <h2 className="text-2xl font-bold text-gray-800 mb-4">ุงููุชุตูุญ ุบูุฑ ูุฏุนูู</h2>
                            <p className="text-gray-600 mb-4">
                                ูุชุตูุญู ูุง ูุฏุนู ุฎุงุตูุฉ ุงูุชุนุฑู ุนูู ุงูุตูุช. ูุฑุฌู ุงุณุชุฎุฏุงู Google Chrome ุฃู Microsoft Edge.
                            </p>
                        </div>
                    </div>
                );
            }

            const currentWord = words[currentWordIndex];
            const progress = ((currentWordIndex + 1) / words.length) * 100;

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 p-4">
                    <div className="max-w-4xl mx-auto">
                        <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
                            <h1 className="text-3xl font-bold text-center text-gray-800 mb-2">
                                ุงุฎุชุจุงุฑ ุงููุฑุงุกุฉ ุงูุตูุชู ๐ค
                            </h1>
                            <p className="text-center text-gray-600 mb-4">
                                ุงูุฑุฃ ุงููููุฉ ุงููุนุฑูุถุฉ ุจุตูุช ูุงุถุญ
                            </p>
                            
                            <div className="w-full bg-gray-200 rounded-full h-3 mb-4">
                                <div 
                                    className="bg-gradient-to-r from-blue-500 to-purple-500 h-3 rounded-full transition-all duration-300"
                                    style={{ width: `${progress}%` }}
                                />
                            </div>
                            
                            <div className="flex justify-around text-center">
                                <div>
                                    <div className="text-2xl font-bold text-blue-600">{currentWordIndex + 1}/{words.length}</div>
                                    <div className="text-sm text-gray-600">ุงููููุงุช</div>
                                </div>
                                <div>
                                    <div className="text-2xl font-bold text-green-600">{score}</div>
                                    <div className="text-sm text-gray-600">ุตุญูุญุฉ</div>
                                </div>
                                <div>
                                    <div className="text-2xl font-bold text-purple-600">{attempts}</div>
                                    <div className="text-sm text-gray-600">ุงููุญุงููุงุช</div>
                                </div>
                                <div>
                                    <div className="text-2xl font-bold text-orange-600">
                                        {attempts > 0 ? Math.round((score / attempts) * 100) : 0}%
                                    </div>
                                    <div className="text-sm text-gray-600">ุงููุฌุงุญ</div>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white rounded-2xl shadow-xl p-8 mb-6">
                            <div className="text-center mb-8">
                                <div className="inline-flex items-center gap-3 mb-4">
                                    <h2 className="text-sm font-medium text-gray-600">ุงูุฑุฃ ูุฐู ุงููููุฉ:</h2>
                                    <button
                                        onClick={speakWord}
                                        className="p-2 rounded-full hover:bg-blue-100 transition-colors"
                                        title="ุงุณุชูุน ูููููุฉ"
                                    >
                                        <VolumeIcon />
                                    </button>
                                </div>
                                
                                <div className="bg-gradient-to-r from-blue-500 to-purple-500 rounded-3xl p-1 mb-6">
                                    <div className="bg-white rounded-3xl p-12">
                                        <div className="text-8xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600">
                                            {currentWord}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div className="flex justify-center mb-6">
                                <button
                                    onClick={isListening ? stopListening : startListening}
                                    className={`p-8 rounded-full transition-all transform hover:scale-105 ${
                                        isListening 
                                            ? 'bg-red-500 shadow-lg shadow-red-300 pulse-ring' 
                                            : 'bg-gradient-to-r from-blue-500 to-purple-500 shadow-lg hover:shadow-xl'
                                    }`}
                                >
                                    {isListening ? <MicOffIcon /> : <MicIcon />}
                                </button>
                            </div>

                            <p className="text-center text-gray-600 mb-6">
                                {isListening ? '๐ค ุฌุงุฑู ุงูุงุณุชูุงุน...' : 'ุงุถุบุท ุนูู ุงููุงููุฑูููู ููุจุฏุก'}
                            </p>

                            {feedback && (
                                <div className={`p-4 rounded-xl mb-6 ${
                                    feedback.type === 'success' 
                                        ? 'bg-green-100 border-2 border-green-300' 
                                        : 'bg-red-100 border-2 border-red-300'
                                }`}>
                                    <div className="flex items-center gap-3">
                                        {feedback.type === 'success' ? <CheckIcon /> : <XIcon />}
                                        <p className={`text-lg font-medium ${
                                            feedback.type === 'success' ? 'text-green-800' : 'text-red-800'
                                        }`}>
                                            {feedback.message}
                                        </p>
                                    </div>
                                </div>
                            )}

                            {transcript && (
                                <div className="bg-gray-50 rounded-xl p-4 mb-6">
                                    <p className="text-sm text-gray-600 mb-1">ูุง ุณูุนุชู:</p>
                                    <p className="text-xl font-medium text-gray-800">{transcript}</p>
                                </div>
                            )}

                            <div className="flex gap-4 justify-center">
                                <button
                                    onClick={nextWord}
                                    disabled={currentWordIndex >= words.length - 1}
                                    className="flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-xl hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                                >
                                    <SkipIcon />
                                    ุงููููุฉ ุงูุชุงููุฉ
                                </button>
                                
                                {currentWordIndex >= words.length - 1 && (
                                    <button
                                        onClick={resetTest}
                                        className="px-6 py-3 bg-gradient-to-r from-green-500 to-teal-500 text-white rounded-xl hover:shadow-lg transition-all"
                                    >
                                        ุฅุนุงุฏุฉ ุงูุงุฎุชุจุงุฑ
                                    </button>
                                )}
                            </div>
                        </div>

                        <div className="bg-white rounded-2xl shadow-xl p-6">
                            <h3 className="text-xl font-bold text-gray-800 mb-4">๐ ุงูุชุนูููุงุช:</h3>
                            <ul className="space-y-2 text-gray-700">
                                <li className="flex items-start gap-2">
                                    <span className="text-blue-600 font-bold">1.</span>
                                    <span>ุงูุฑุฃ ุงููููุฉ ุงููุนุฑูุถุฉ ุนูู ุงูุดุงุดุฉ</span>
                                </li>
                                <li className="flex items-start gap-2">
                                    <span className="text-blue-600 font-bold">2.</span>
                                    <span>ุงุถุบุท ุนูู ุฃููููุฉ ุงููุงููุฑูููู ูุงุจุฏุฃ ุจุงููุฑุงุกุฉ ุจุตูุช ูุงุถุญ</span>
                                </li>
                                <li className="flex items-start gap-2">
                                    <span className="text-blue-600 font-bold">3.</span>
                                    <span>ุงูุชุธุฑ ุงููุชูุฌุฉ ูุงูุชูู ูููููุฉ ุงูุชุงููุฉ</span>
                                </li>
                                <li className="flex items-start gap-2">
                                    <span className="text-blue-600 font-bold">๐ก</span>
                                    <span>ููููู ุงูุถุบุท ุนูู ุฃููููุฉ ุงูุณูุงุนุฉ ูุณูุงุน ูุทู ุงููููุฉ ุงูุตุญูุญ</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<VoiceReadingTest />);
    </script>
</body>
</html>
